# Poker Telegram Bot

Телеграм-бот на Go, который оценивает шансы на победу в Техасском Холдеме методом Монте-Карло.

## Возможности
- Парсинг пользовательского сообщения с параметрами раздачи (карты на руках, общее число игроков, стиль соперников, борд, количество симуляций).
- Симуляция раздач с различными стилями соперников (тайтовый, сбалансированный, лузовый).
- Подробный ответ с вероятностями победы, ничьей и поражения.
- Покрытие ключевой логики юнит-тестами (парсер, форматтер, эмулятор рук, симулятор).

## Запуск локально
1. Получите токен бота у [BotFather](https://t.me/botfather).
2. Экспортируйте токен в переменную окружения:
   ```sh
   export TELEGRAM_BOT_TOKEN=ваш_токен
   ```
3. Запустите бота:
   ```sh
   go run ./cmd/bot
   ```

## Формат сообщения
```
hand: Ah Kh
players: 4
style: tight
board: Qh Jh Td
trials: 7000
```

### Интерактивное меню
- Отправьте команду `/menu`, чтобы открыть конструктор запроса прямо в чате.
- Используйте кнопки, чтобы задать карты, количество игроков, стиль соперников и другие параметры.
- После заполнения нажмите «Запустить», бот выполнит симуляцию и отправит результат.

- `hand` — две карты героя (обязательный параметр).
- `players` — общее количество игроков за столом (минимум 2).
- `style` — стиль соперников (`tight`, `balanced`, `loose`).
- `board` — известные карты на столе (0–5 карт).
- `trials` — количество симуляций Монте-Карло (опционально, по умолчанию 7000).

Бот поддерживает русские ключевые слова: `карты`, `игроков`, `стиль`, `борд`, `симуляций`.

## Тестирование
```sh
go test ./...
```

## Контейнеризация
- Собрать локальный образ:
  ```sh
  docker build -t pokerbot:latest .
  ```
- Запустить контейнер:
  ```sh
  docker run --rm -e TELEGRAM_BOT_TOKEN=ваш_токен pokerbot:latest
  ```
- Для фонового запуска и автоперезапуска:
  ```sh
  docker run -d --name pokerbot --restart=always \
    -e TELEGRAM_BOT_TOKEN=ваш_токен \
    ghcr.io/<ваш-аккаунт>/<репозиторий>:latest
  ```

## CI/CD и деплой
- GitHub Actions workflow `.github/workflows/deploy.yml` запускается при пуше в `main` и по запросу.
- Он выполняет `go test ./...`, собирает Docker-образ и пушит его в GitHub Container Registry (`ghcr.io`).
- Для автоматического деплоя на сервер установите секреты репозитория:
  - `DEPLOY_HOST` — адрес сервера с Docker.
  - `DEPLOY_USER` — SSH-пользователь.
  - `DEPLOY_SSH_KEY` — приватный ключ для подключения.
  - `TELEGRAM_BOT_TOKEN` — токен бота, передается контейнеру.
- После успешного деплоя контейнер запускается/перезапускается под именем `pokerbot` с политикой `--restart=always`.
